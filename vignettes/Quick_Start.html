<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Quick Start Guide</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<!-- MathJax 3 with sections 
Add <div style="display:none">$\nextSection$</div>
after each section to update the counter -->
<script>
MathJax = {
  loader: {load: ['[tex]/tagformat']},
  section: 1,
  tex: {
    tags: 'ams',
    packages: {'[+]': ['tagformat', 'sections']},
    tagformat: {
      number: (n) => MathJax.config.section + '.' + n
    }
  },
  startup: {
    ready() {
      const Configuration = MathJax._.input.tex.Configuration.Configuration;
      const CommandMap = MathJax._.input.tex.SymbolMap.CommandMap;
      new CommandMap('sections', {
        nextSection: 'NextSection'
      }, {
        NextSection(parser, name) {
          MathJax.config.section++;
          parser.tags.counter = parser.tags.allCounter = 0;
        }
      });
      Configuration.create(
        'sections', {handler: {macro: ['sections']}}
      );
      MathJax.startup.defaultReady();
    }
  }
};</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Quick Start Guide</h1>


<div id="TOC">
<ul>
<li><a href="#summary" id="toc-summary">Summary</a></li>
<li><a href="#the-marss-model" id="toc-the-marss-model">The MARSS
model</a></li>
<li><a href="#data-and-fitting" id="toc-data-and-fitting">Data and
fitting</a></li>
<li><a href="#defaults-for-model-list" id="toc-defaults-for-model-list">Defaults for <code>model</code>
list</a></li>
<li><a href="#showing-the-model-fits-and-getting-the-parameters" id="toc-showing-the-model-fits-and-getting-the-parameters">Showing the
model fits and getting the parameters</a></li>
<li><a href="#tips-and-troubleshooting" id="toc-tips-and-troubleshooting">Tips and Troubleshooting</a></li>
<li><a href="#more-information-and-tutorials" id="toc-more-information-and-tutorials">More information and
tutorials</a></li>
<li><a href="#shortcuts-and-all-allowed-model-structures" id="toc-shortcuts-and-all-allowed-model-structures">Shortcuts and all
allowed model structures</a></li>
<li><a href="#covariates-linear-constraints-and-time-varying-parameters" id="toc-covariates-linear-constraints-and-time-varying-parameters">Covariates,
Linear constraints and time-varying parameters</a></li>
</ul>
</div>

<div id="summary" class="section level1">
<h1>Summary</h1>
<p>Put data (<code>y</code>) in a <span class="math inline">\(n \times
T\)</span> matrix or ts/mts object.</p>
<p>Specify each of the parameters in a list for the <code>model</code>
argument.</p>
<p>Fit with</p>
<pre><code>fit &lt;- MARSS(y, model=list(...), method=c(&quot;kem&quot;, &quot;BFGS&quot;, &quot;TMB&quot;))</code></pre>
<p>Choose one method from <code>c(&quot;kem&quot;, &quot;BFGS&quot;, &quot;TMB&quot;)</code>.</p>
</div>
<div id="the-marss-model" class="section level1">
<h1>The MARSS model</h1>
<p>The {MARSS} package fits multivariate autoregressive state-space
(MARSS) models of the form: <span class="math display">\[\begin{equation}\label{eqn:marss}
\begin{gathered}
\boldsymbol{x}_t = \mbox{$\mathbf B$}_t\boldsymbol{x}_{t-1} +
\mbox{$\mathbf U$}_t + \mbox{$\mathbf C$}_t\mbox{$\mathbf c$}_t +
\mbox{$\mathbf G$}_t\boldsymbol{w}_t, \text{ where } \boldsymbol{W}_t
\sim \,\textup{\textrm{MVN}}(0,\mbox{$\mathbf Q$}_t)\\
\boldsymbol{y}_t = \mbox{$\mathbf Z$}_t\boldsymbol{x}_t + \mbox{$\mathbf
A$}_t + \mbox{$\mathbf D$}_t\mbox{$\mathbf d$}_t + \mbox{$\mathbf
H$}_t\boldsymbol{v}_t, \text{ where } \boldsymbol{V}_t \sim
\,\textup{\textrm{MVN}}(0,\mbox{$\mathbf R$}_t)\\
\boldsymbol{X}_1 \sim
\,\textup{\textrm{MVN}}(\boldsymbol{\xi},\boldsymbol{\Lambda}) \text{ or
} \boldsymbol{X}_0 \sim
\,\textup{\textrm{MVN}}(\boldsymbol{\xi},\boldsymbol{\Lambda})
\end{gathered}
\end{equation}\]</span> <span class="math inline">\(\mbox{$\mathbf
c$}\)</span> and <span class="math inline">\(\mbox{$\mathbf d$}\)</span>
are inputs (aka, exogenous variables or covariates or indicator
variables) and must have no missing values. They are not treated as
`data’ in the likelihood but as inputs. In most cases, <span class="math inline">\(\mbox{$\mathbf G$}\)</span> and <span class="math inline">\(\mbox{$\mathbf H$}\)</span> are fixed (not
estimated) and must have no missing values, but see the User Guide on
situations when they can be estimated. The <span class="math inline">\(\mbox{$\mathbf R$}\)</span>, <span class="math inline">\(\mbox{$\mathbf Q$}\)</span> and <span class="math inline">\(\boldsymbol{\Lambda}\)</span> variances can can
have zeros on the diagonal to specify partially deterministic systems.
This allows you to write MAR(p) models in MARSS form for example. See
the User Guide for examples.</p>
<p>The {MARSS} package is designed to handle linear constraints within
the parameter matrices: <span class="math inline">\(\mbox{$\mathbf
B$}\)</span>, <span class="math inline">\(\mbox{$\mathbf U$}\)</span>,
<span class="math inline">\(\mbox{$\mathbf C$}\)</span>, <span class="math inline">\(\mbox{$\mathbf Q$}\)</span>, <span class="math inline">\(\mbox{$\mathbf Z$}\)</span>, <span class="math inline">\(\mbox{$\mathbf A$}\)</span>, <span class="math inline">\(\mbox{$\mathbf D$}\)</span>, <span class="math inline">\(\mbox{$\mathbf R$}\)</span>, <span class="math inline">\(\boldsymbol{\xi}\)</span>, and <span class="math inline">\(\boldsymbol{\Lambda}\)</span> (and in limited
situations <span class="math inline">\(\mbox{$\mathbf G$}\)</span> and
<span class="math inline">\(\mbox{$\mathbf H$}\)</span>). Linear
constraint means you can write the elements of the matrix as a linear
equation of all the other elements. Example below.</p>
<p><em>Note: Specification of a properly constrained model with a unique
solution is the responsibility of the user because the {MARSS} package
has no way to tell if you have specified an insufficiently constrained
model.</em></p>
<p>Example: a mean-reverting random walk model with three observation
time series: <span class="math display">\[\begin{gather}\label{eq:example1}
\begin{bmatrix}x_1\\ x_2\end{bmatrix}_t
= \begin{bmatrix}b&amp;0\\ 0&amp;b\end{bmatrix}
\begin{bmatrix}x_1\\ x_2\end{bmatrix}_{t-1}
+ \begin{bmatrix}w_1\\ w_2\end{bmatrix}_t, \quad
\begin{bmatrix}w_1\\ w_2\end{bmatrix}_t \sim
\,\textup{\textrm{MVN}}\begin{pmatrix}\begin{bmatrix}0\\0\end{bmatrix},\begin{bmatrix}q_{11}&amp;q_{12}\\
q_{12}&amp;q_{22}\end{bmatrix} \end{pmatrix}
\\
\begin{bmatrix}x_1\\ x_2\end{bmatrix}_0 \sim
\,\textup{\textrm{MVN}}\begin{pmatrix}\begin{bmatrix}0\\
0\end{bmatrix},\begin{bmatrix}1&amp;0\\ 0&amp;1\end{bmatrix}
\end{pmatrix} \\
\\
\begin{bmatrix}y_1\\y_2\\y_3\end{bmatrix}_t
= \begin{bmatrix}1&amp;1\\ 0&amp;1\\ 1&amp;0\end{bmatrix}
\begin{bmatrix}x_1\\x_2\end{bmatrix}_t
+ \begin{bmatrix}v_1\\ v_2\\ v_3\end{bmatrix}_t,\quad
\begin{bmatrix}v_1\\ v_2\\ v_3\end{bmatrix}_t \sim
MVN\begin{pmatrix}\begin{bmatrix}a_1\\ 0\\ 0\end{bmatrix},
\begin{bmatrix}r_{11}&amp;0&amp;0\\ 0&amp;r&amp;0\\
0&amp;0&amp;r\end{bmatrix} \end{pmatrix}
\end{gather}\]</span></p>
<div id="model-specification" class="section level2">
<h2>Model specification</h2>
<p>Model specification is via a list with the structure of each of the
model parameters: <span class="math inline">\(\mbox{$\mathbf
B$}\)</span>, <span class="math inline">\(\mbox{$\mathbf U$}\)</span>,
<span class="math inline">\(\mbox{$\mathbf C$}\)</span>, <span class="math inline">\(\mbox{$\mathbf Q$}\)</span>, <span class="math inline">\(\mbox{$\mathbf Z$}\)</span>, <span class="math inline">\(\mbox{$\mathbf A$}\)</span>, <span class="math inline">\(\mbox{$\mathbf D$}\)</span>, <span class="math inline">\(\mbox{$\mathbf R$}\)</span>, <span class="math inline">\(\boldsymbol{\xi}\)</span>, and<span class="math inline">\(\boldsymbol{\Lambda}\)</span>. There is a
one-to-one correspondence between the model in and the math version of
the model. The model written in matrix form is translated into
equivalent matrices (or arrays if time-varying) in code. Matrices that
combine fixed and estimated values are specified using a list matrix
with numerical values for fixed values and character names for the
estimated values.</p>
<p>For <span class="math inline">\(\ref{eq:example1}\)</span>, this
would be:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>B1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">list</span>(<span class="st">&quot;b&quot;</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="st">&quot;b&quot;</span>),<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>U1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>Q1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="st">&quot;q11&quot;</span>,<span class="st">&quot;q12&quot;</span>,<span class="st">&quot;q12&quot;</span>,<span class="st">&quot;q22&quot;</span>),<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>Z1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>A1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">list</span>(<span class="st">&quot;a1&quot;</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="dv">3</span>,<span class="dv">1</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>R1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">list</span>(<span class="st">&quot;r11&quot;</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="st">&quot;r&quot;</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="st">&quot;r&quot;</span>),<span class="dv">3</span>,<span class="dv">3</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>pi1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">1</span>); V1<span class="ot">=</span><span class="fu">diag</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>model.list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">B=</span>B1,<span class="at">U=</span>U1,<span class="at">Q=</span>Q1,<span class="at">Z=</span>Z1,<span class="at">A=</span>A1,<span class="at">R=</span>R1,<span class="at">x0=</span>pi1,<span class="at">V0=</span>V1,<span class="at">tinitx=</span><span class="dv">0</span>)</span></code></pre></div>
<p>The <code>tinitx</code> element tells MARSS whether the initial state
for <span class="math inline">\(x\)</span> is at <span class="math inline">\(t=1\)</span> (<code>tinitx=1</code>) or <span class="math inline">\(t=0\)</span> (<code>tinitx=0</code>).</p>
<p>MARSS has a number of text shortcuts for common parameter forms, such
as <code>&quot;diagonal and unequal&quot;</code>; see below for the possible
shortcuts.</p>
</div>
</div>
<div id="data-and-fitting" class="section level1">
<h1>Data and fitting</h1>
<div id="data" class="section level2">
<h2>Data</h2>
<p>The data must be entered as a <span class="math inline">\(n \times
T\)</span> matrix, or a ts (or mts) object or vector (which will be
converted to a <span class="math inline">\(n \times T\)</span>
matrix).</p>
</div>
<div id="fit-call" class="section level2">
<h2>Fit call</h2>
<p>The call to fit the model is.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(y, <span class="at">model=</span>model.list)</span></code></pre></div>
<p>See <code>?MARSS</code> for all other arguments. The common ones are
<code>method</code> to change the fitting method from default of EM
(slow). See below. <code>control</code> is used to pass in a list to
control fitting, e.g. <code>control=list(maxit=1000)</code> to increase
maximum iterations if the fit does not converge.</p>
<p>Example with simulated data:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MARSS)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">arima.sim</span>(<span class="at">n=</span><span class="dv">50</span>,<span class="fu">list</span>(<span class="at">ar=</span><span class="fl">0.95</span>), <span class="at">sd=</span><span class="fl">0.4</span>), </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">arima.sim</span>(<span class="at">n=</span><span class="dv">50</span>,<span class="fu">list</span>(<span class="at">ar=</span><span class="fl">0.95</span>), <span class="at">sd=</span>.<span class="dv">02</span>))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> Z1 <span class="sc">%*%</span> x <span class="sc">+</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">3</span><span class="sc">*</span><span class="dv">50</span>,<span class="dv">0</span>,<span class="fl">0.1</span>), <span class="dv">3</span>, <span class="dv">50</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(y, <span class="at">model=</span>model.list, <span class="at">silent=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(fit)</span></code></pre></div>
<pre><code>##    term     estimate    std.error      conf.low      conf.up
## 1  A.a1 0.0184598413 0.0269628326 -0.0343863395 0.0713060221
## 2 R.r11 0.0188070225 0.0062216241  0.0066128633 0.0310011817
## 3   R.r 0.0115645650 0.0024433098  0.0067757658 0.0163533641
## 4   B.b 0.8605716318 0.0634069752  0.7362962441 0.9848470195
## 5 Q.q11 0.1301323970 0.0288070155  0.0736716842 0.1865931098
## 6 Q.q12 0.0020987299 0.0029632765 -0.0037091853 0.0079066452
## 7 Q.q22 0.0001353807 0.0003058603 -0.0004640944 0.0007348558</code></pre>
</div>
<div id="different-fitting-methods" class="section level2">
<h2>Different fitting methods</h2>
<p>The EM algorithm in the {MARSS} package is in R and on top of that EM
algorithms are famously slow. You can try <code>method=&quot;BFGS&quot;</code> and
see if that is faster. For some models, it will be much faster and for
others slower. The companion package {marssTMB} allows you to fit these
models with TMB and will be the fastest, often much faster. Definitely
if you are doing Dynamic Factor Analysis or working with large data
sets, you will want to install {marssTMB} so you can fit with TMB.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marssTMB)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(y, <span class="at">model=</span>model.list, <span class="at">silent=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(y, <span class="at">model=</span>model.list, <span class="at">method=</span><span class="st">&quot;BFGS&quot;</span>, <span class="at">silent=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(y, <span class="at">model=</span>model.list, <span class="at">method=</span><span class="st">&quot;TMB&quot;</span>, <span class="at">silent=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;logLL of the 3 fits:&quot;</span>, <span class="fu">c</span>(fit1<span class="sc">$</span>logLik, fit2<span class="sc">$</span>logLik, fit3<span class="sc">$</span>logLik))</span></code></pre></div>
<pre><code>## logLL of the 3 fits: 30.75614 30.82143 28.691</code></pre>
<p><code>method=&quot;BFGS&quot;</code> and <code>method=&quot;TMB&quot;</code> are both
using quasi-Newton methods to optimize and these can be sensitive to
initial conditions. You can run EM a few iterations and run with BFGS,
and this will guard against poor initial conditions issues.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(y, <span class="at">model=</span>model.list, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">15</span>))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(y, <span class="at">model=</span>model.list, <span class="at">method=</span><span class="st">&quot;BFGS&quot;</span>, <span class="at">inits =</span> fit1)</span></code></pre></div>
</div>
</div>
<div id="defaults-for-model-list" class="section level1">
<h1>Defaults for <code>model</code> list</h1>
<p>Form of the model list is <code>list(B=..., U=...)</code> etc.</p>
<div id="formmarxss" class="section level2">
<h2><code>form=&quot;marxss&quot;</code></h2>
<p>For <code>form=&quot;marxss&quot;</code> (the default), matrix names in the
model list must be <code>B</code>, <code>U</code>, <code>C</code>,
<code>c</code>, <code>Q</code>, <code>Z</code>, <code>A</code>,
<code>D</code>, <code>d</code>, <code>R</code>, <code>x0</code> (<span class="math inline">\(\boldsymbol{\xi}\)</span>), and <code>V0</code>
(<span class="math inline">\(\boldsymbol{\Lambda}\)</span>), just like
in Equation <span class="math inline">\(\ref{eqn:marss}\)</span>. There
are defaults each parameter and you can leave off matrix names and the
defaults will be used. Type <code>?MARSS.marxss</code> additional
information.</p>
<ul>
<li><code>B=&quot;identity&quot;</code> <span class="math inline">\(m \times
m\)</span> identity matrix</li>
<li><code>U=&quot;unequal&quot;</code> Each element in the <span class="math inline">\(m \times 1\)</span> matrix <span class="math inline">\(\mbox{$\mathbf U$}\)</span> is estimated and
allowed to be different.</li>
<li><code>Q=&quot;diagonal and unequal&quot;</code> <span class="math inline">\(\mbox{$\mathbf Q$}\)</span> is a diagonal matrix
and each element on the diagonal is allowed to be different.</li>
<li><code>Z=&quot;identity&quot;</code> <span class="math inline">\(n \times
n\)</span> identity matrix thus in the default model each <span class="math inline">\(y\)</span> is associated with one <span class="math inline">\(x\)</span>.</li>
<li><code>A=&quot;scaling&quot;</code> If <span class="math inline">\(\mbox{$\mathbf Z$}\)</span> is identity, <span class="math inline">\(\mbox{$\mathbf A$}\)</span> is zero. Otherwise,
the first <span class="math inline">\(y\)</span> associated with a <span class="math inline">\(x\)</span> is set to 0 and the rest are
estimated.</li>
<li><code>R=&quot;diagonal and equal&quot;</code> <span class="math inline">\(\mbox{$\mathbf R$}\)</span> is a diagonal matrix
and each element on the diagonal is the same.</li>
<li><code>x0=&quot;unequal&quot;</code> Each element in the <span class="math inline">\(m \times 1\)</span> matrix <span class="math inline">\(\boldsymbol{\xi}\)</span> is estimated and allowed
to be different.</li>
<li><code>V0=&quot;zero&quot;</code> <span class="math inline">\(\boldsymbol{\Lambda}\)</span> is set to zero thus
<span class="math inline">\(\boldsymbol{x}_0\)</span> is treated as an
estimated parameter.</li>
<li><code>tinitx=0</code> The initial condition for <span class="math inline">\(\boldsymbol{x}\)</span> is set at <span class="math inline">\(t=0\)</span>.</li>
</ul>
</div>
<div id="formdfa" class="section level2">
<h2><code>form=&quot;dfa&quot;</code></h2>
<p>Special form for fitting DFA models. Pass in <code>form=&quot;dfa&quot;</code>
to the <code>MARSS()</code> call. Typically only these would be in the
model list:</p>
<ul>
<li><code>m=1</code> Number of factors.</li>
<li><code>R=&quot;diagonal and equal&quot;</code> <span class="math inline">\(\mbox{$\mathbf R$}\)</span> is a diagonal matrix
and each element on the diagonal is the same.</li>
<li><code>d=&quot;zero&quot;</code> If there are <span class="math inline">\(p\)</span> covariates, pass in as a <span class="math inline">\(p \times T\)</span> matrix.</li>
<li><code>D=&quot;unconstrained&quot;</code> if covariates passed in.</li>
</ul>
<p>Defaults.</p>
<ul>
<li><code>Z</code> A special unconstrained matrix with the upper
triangle (without the diagonal) set to zero.</li>
<li><code>Q=&quot;identity&quot;</code> <span class="math inline">\(\mbox{$\mathbf
Q$}\)</span> is a diagonal matrix and each element on the diagonal is
allowed to be different.</li>
<li><code>x0=&quot;zero&quot;</code> Each element in the <span class="math inline">\(m \times 1\)</span> matrix <span class="math inline">\(\boldsymbol{\xi}\)</span> is estimated and allowed
to be different.</li>
<li><code>V0=diag(5,n)</code> <span class="math inline">\(\boldsymbol{\Lambda}\)</span> is set to a diagonal
matrix with 5 on the diagonal.</li>
<li><code>tinitx=0</code> The initial condition for <span class="math inline">\(\boldsymbol{x}\)</span> is set at <span class="math inline">\(t=0\)</span>.</li>
<li><code>B=&quot;identity&quot;</code> <span class="math inline">\(m \times
m\)</span> identity matrix</li>
<li><code>U=&quot;zero&quot;</code></li>
<li><code>A=&quot;zero&quot;</code></li>
</ul>
</div>
</div>
<div id="showing-the-model-fits-and-getting-the-parameters" class="section level1">
<h1>Showing the model fits and getting the parameters</h1>
<p>There are <code>plot</code>, <code>autoplot</code>,
<code>print</code>, <code>summary</code>, <code>coef</code>,
<code>fitted</code>, <code>residuals</code> and <code>predict</code>
functions for marssMLE objects. <code>?print.MARSS</code> will show you
how to get standard output from your fitted model objects and where that
output is stored in the marssMLE object. Type <code>?coef.MARSS</code>
to see the different formats for displaying the estimated parameters. To
see plots of your states and fits plus diagnostic plots, use
<code>plot(fit)</code> or, better, <code>ggplot2::autoplot(fit)</code>.
For summaries of the residuals (model and state), use the
<code>residuals</code> function. See <code>?residuals.marssMLE</code>.
To produce predictions and forecasts from a MARSS model, see
<code>?predict.marssMLE</code>.</p>
</div>
<div id="tips-and-troubleshooting" class="section level1">
<h1>Tips and Troubleshooting</h1>
<div id="tips" class="section level2">
<h2>Tips</h2>
<p>Use <code>ggplot2::autoplot(fit)</code> (or <code>plot(fit)</code>)
to see a series of standard plots and diagnostics for your model. Use
<code>tidy(fit)</code> for parameter estimates or
<code>coef(fit)</code>. Use <code>fitted(fit)</code> for model (<span class="math inline">\(\boldsymbol{y}\)</span>) estimates and
<code>tsSmooth(fit)</code> for states (<span class="math inline">\(\boldsymbol{x}\)</span>) estimates. You can also
use <code>fit$states</code> for the states.</p>
<p>Let’s say you specified your model with some text short-cuts, like
<code>Q=&quot;unconstrained&quot;</code>, but you want the list matrix for for a
next step. <code>a &lt;- summary(fit$model)</code> returns that list
(invisibly). Because the model argument of <code>MARSS()</code> will
understand a list of list matrices, you can pass in <code>model=a</code>
to specify the model.
<code>MARSSkfas(fit, return.kfas.model=TRUE)</code> will return your
model in {KFAS} format (class SSModel), thus you can use all the
functions available in the {KFAS} package on your model.</p>
</div>
<div id="troubleshooting" class="section level2">
<h2>Troubleshooting</h2>
<p>Try <code>MARSSinfo()</code> if you get errors you don’t understand
or fitting is taking a long time to converge. When fitting a model with
<code>MARSS()</code>, pass in <code>silent=2</code> to see what
<code>MARSS()</code> is doing. This puts it in verbose mode. Use
<code>fit=FALSE</code> to set up a model without fitting. Let’s say you
do <code>fit &lt;- MARSS(..., fit=FALSE)</code>. Now you can do
<code>summary(fit$model)</code> to see what <code>MARSS()</code> thinks
you are trying to fit.</p>
<p>You can also try <code>toLatex(fit$model)</code> to make a LaTeX file
and pdf version of your model (saved in the working directory). This
loads the {Hmisc} package (and all its dependencies) and requires that
you are able to process LaTeX files.</p>
</div>
</div>
<div id="more-information-and-tutorials" class="section level1">
<h1>More information and tutorials</h1>
<p>Many example analyses can be found in the MARSS User Guide (<a href="https://cran.r-project.org/web/packages/MARSS/vignettes/UserGuide.pdf">pdf</a>).
In addition, recorded lectures and more examples on fitting multivariate
models can be found at our course <a href="https://atsa-es.github.io/atsa">website</a> and in the ATSA course
eBook <a href="https://atsa-es.github.io/atsa-labs">html</a>.</p>
<p>The MARSS User Guide starts with some tutorials on MARSS models and
walks through many examples showing how to write multivariate
time-series models in MARSS form. The User Guide also has vignettes: how
to write AR(p) models in state-space form, dynamic linear models
(regression models where the regression parameters are AR(p)),
multivariate regression models with regression parameters that are
time-varying and enter the non-AR part of your model or the AR part,
detecting breakpoints using state-space models, and dynamic factor
analysis. All of these can be written in MARSS form. It also has a
series of vignettes on analysis of multivariate biological data.</p>
<p>Background on the algorithms used in the {MARSS} package is included
in the User Guide.</p>
</div>
<div id="shortcuts-and-all-allowed-model-structures" class="section level1">
<h1>Shortcuts and all allowed model structures</h1>
<p>All parameters except <code>x0</code> and <code>V0</code> may be
time-varying. If time-varying, then text shortcuts cannot be used. Enter
as an array with the 3rd dimension being time. Time dimension must be 1
or equal to the number of time-steps in the data.</p>
<p>The model list elements can have the following values:</p>
<div id="z" class="section level2">
<h2><code>Z</code></h2>
<p>Defaults to <code>&quot;identity&quot;</code>. Can be a text string,
<code>&quot;identity&quot;</code>, <code>&quot;unconstrained&quot;</code>,
<code>&quot;diagonal and unequal&quot;</code>, <code>&quot;diagonal and equal&quot;</code>,
<code>&quot;equalvarcov&quot;</code>, or <code>&quot;onestate&quot;</code>, or a length
<span class="math inline">\(n\)</span> vector of factors specifying
which of the <span class="math inline">\(m\)</span> hidden state time
series correspond to which of the n observation time series. May be
specified as a <span class="math inline">\(n \times m\)</span> list
matrix for general specification of both fixed and shared elements
within the matrix. May also be specified as a numeric <span class="math inline">\(n \times m\)</span> matrix to use a custom fixed
<span class="math inline">\(\mbox{$\mathbf Z$}\)</span>.
<code>&quot;onestate&quot;</code> gives a <span class="math inline">\(n \times
1\)</span> matrix of 1s. The text shortcuts all specify <span class="math inline">\(n \times n\)</span> matrices.</p>
</div>
<div id="b" class="section level2">
<h2><code>B</code></h2>
<p>Defaults to <code>&quot;identity&quot;</code>. Can be a text string,
<code>&quot;identity&quot;</code>, <code>&quot;unconstrained&quot;</code>,
<code>&quot;diagonal and unequal&quot;</code>, <code>&quot;diagonal and equal&quot;</code>,
<code>&quot;equalvarcov&quot;</code>, <code>&quot;zero&quot;</code>. Can also be specified
as a list matrix for general specification of both fixed and shared
elements within the matrix. May also be specified as a numeric <span class="math inline">\(m \times m\)</span> matrix to use custom fixed
<span class="math inline">\(\mbox{$\mathbf B$}\)</span>, but in this
case all the eigenvalues of <span class="math inline">\(\mbox{$\mathbf
B$}\)</span> must fall in the unit circle.</p>
</div>
<div id="u-and-x0" class="section level2">
<h2><code>U</code> and <code>x0</code></h2>
<p>Defaults to <code>&quot;unequal&quot;</code>. Can be a text string,
<code>&quot;unconstrained&quot;</code>, <code>&quot;equal&quot;</code>,
<code>&quot;unequal&quot;</code> or <code>&quot;zero&quot;</code>. May be specified as a
<span class="math inline">\(m \times 1\)</span> list matrix for general
specification of both fixed and shared elements within the matrix. May
also be specified as a numeric <span class="math inline">\(m \times
1\)</span> matrix to use a custom fixed <span class="math inline">\(\mbox{$\mathbf U$}\)</span> or <span class="math inline">\(\boldsymbol{x}_0\)</span>.</p>
</div>
<div id="a" class="section level2">
<h2><code>A</code></h2>
<p>Defaults to <code>&quot;scaling&quot;</code>. Can be a text string,
<code>&quot;scaling&quot;</code> ,<code>&quot;unconstrained&quot;</code>,
<code>&quot;equal&quot;</code>, “unequal” or “zero”. May be specified as a n x 1
list matrix for general specification of both fixed and shared elements
within the matrix. May also be specified as a numeric <span class="math inline">\(n \times 1\)</span> matrix to use a custom fixed
<span class="math inline">\(\mbox{$\mathbf A$}\)</span>. Care must be
taken so that the model is not under-constrained and unsolvable model.
The default, <code>&quot;scaling&quot;</code>, only applies to <span class="math inline">\(\mbox{$\mathbf Z$}\)</span> matrices that are
design matrices (only 1s and 0s and all rows sum to 1). When a column in
<span class="math inline">\(\mbox{$\mathbf Z$}\)</span> has multiple 1s,
the first row in the <span class="math inline">\(\mbox{$\mathbf
A$}\)</span> matrix associated with those <span class="math inline">\(\mbox{$\mathbf Z$}\)</span> rows is 0 and the
other associated <span class="math inline">\(\mbox{$\mathbf A$}\)</span>
rows have an estimated value. This treats <span class="math inline">\(\mbox{$\mathbf A$}\)</span> as an intercept where
one intercept for each <span class="math inline">\(\boldsymbol{x}\)</span> (hidden state) is fixed at
0 and any other intercepts associated with that <span class="math inline">\(\boldsymbol{x}\)</span> have an estimated
intercept. This ensures a solvable model when <span class="math inline">\(\mbox{$\mathbf Z$}\)</span> is a design
matrix.</p>
</div>
<div id="q-r-and-v0" class="section level2">
<h2><code>Q</code>, <code>R</code> and <code>V0</code></h2>
<p>Can be a text string, <code>&quot;identity&quot;</code>,
<code>&quot;unconstrained&quot;</code>, <code>&quot;diagonal and unequal&quot;</code>,
<code>&quot;diagonal and equal&quot;</code>, <code>&quot;equalvarcov&quot;</code>, “zero”.
May be specified as a list matrix for general specification of both
fixed and shared elements within the matrix. May also be specified as a
numeric matrix to use a custom fixed matrix.</p>
<p><code>V0</code> defaults to <code>&quot;zero&quot;</code>, which means that
<span class="math inline">\(\boldsymbol{x}_0\)</span> is treated as an
estimated parameter.</p>
</div>
<div id="d-and-c" class="section level2">
<h2><code>D</code> and <code>C</code></h2>
<p>Defaults to <code>&quot;zero&quot;</code> or if no covariates, defaults to
<code>&quot;unconstrained&quot;</code>. Can also be any of the options available
for the variance matrices.</p>
</div>
<div id="d-and-c-1" class="section level2">
<h2><code>d</code> and <code>c</code></h2>
<p>Defaults to <code>&quot;zero&quot;</code>. Numeric matrix. No missing values
allowed. Must have 1 column or the same number of columns as the data,
The numbers of rows in must match the corresponding <span class="math inline">\(\mbox{$\mathbf D$}\)</span> or <span class="math inline">\(\mbox{$\mathbf C$}\)</span> matrix.</p>
</div>
<div id="g-and-h" class="section level2">
<h2><code>G</code> and <code>H</code></h2>
<p>Defaults to <code>&quot;identity&quot;</code>. Can be specified as a numeric
matrix or array for time-varying cases. Size must match the
corresponding <span class="math inline">\(\mbox{$\mathbf Q$}\)</span> or
<span class="math inline">\(\mbox{$\mathbf R$}\)</span> matrix.</p>
</div>
</div>
<div id="covariates-linear-constraints-and-time-varying-parameters" class="section level1">
<h1>Covariates, Linear constraints and time-varying parameters</h1>
<div id="covariates" class="section level2">
<h2>Covariates</h2>
<p>Inputs, aka covariates, are in <span class="math inline">\(\mbox{$\mathbf c$}\)</span> and <span class="math inline">\(\mbox{$\mathbf d$}\)</span>. The are passed in via
the model list and must be a numeric matrix (no missing values). <span class="math inline">\(\mbox{$\mathbf C$}\)</span> and <span class="math inline">\(\mbox{$\mathbf D$}\)</span> are the estimated
parameters, aka covariate effects.</p>
<p>Let’s say you have temperature data and you want to include a linear
effect of temperature that is different for each <span class="math inline">\(\boldsymbol{x}\)</span> time series:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">50</span>), <span class="fl">0.1</span>),<span class="at">nrow=</span><span class="dv">1</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>C1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="st">&quot;temp1&quot;</span>,<span class="st">&quot;temp2&quot;</span>),<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>model.list<span class="sc">$</span>C <span class="ot">&lt;-</span> C1</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>model.list<span class="sc">$</span>c <span class="ot">&lt;-</span> temp</span></code></pre></div>
<p>Fit as normal:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(y, <span class="at">model=</span>model.list, <span class="at">method=</span><span class="st">&quot;BFGS&quot;</span>)</span></code></pre></div>
<p>A seasonal effect can be easily included via sine/cosine pairs. The
<code>fourier()</code> function in the {forecast} package simplifies
this. You will need to make your data into a ts/mts object.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>yts <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">t</span>(y), <span class="at">frequency =</span> <span class="dv">12</span>) <span class="co"># requires time down the rows</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>fcov <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">fourier</span>(yts,<span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">t</span>()</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;quantmod&#39;:
##   method            from
##   as.zoo.data.frame zoo</code></pre>
<p>If you want a factor effect, then you can use the
<code>seasonaldummy()</code> function in {forecast}</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>yts <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">t</span>(y), <span class="at">frequency =</span> <span class="dv">12</span>) <span class="co"># monthly data</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>mcov <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">seasonaldummy</span>(yts) <span class="sc">|&gt;</span> <span class="fu">t</span>() <span class="co"># month factor</span></span></code></pre></div>
</div>
<div id="linear-constraints" class="section level2">
<h2>Linear constraints</h2>
<p>Your model can have simple linear constraints within all the
parameters except <span class="math inline">\(\mbox{$\mathbf
Q$}\)</span>, <span class="math inline">\(\mbox{$\mathbf R$}\)</span>
and <span class="math inline">\(\boldsymbol{\Lambda}\)</span>. For
example <span class="math inline">\(1+2a-3b\)</span> is a linear
constraint. When entering this value for you matrix, you specify this as
<code>&quot;1+2*a+-3*b&quot;</code>. NOTE: <span class="math inline">\(+\)</span>’s join parts so <code>+-3*b</code> to
specify <span class="math inline">\(-3b\)</span>. Anything after
<code>*</code> is a parameter. So <code>1*1</code> has a parameter
called <code>&quot;1&quot;</code>. Example, let’s change the <span class="math inline">\(\mbox{$\mathbf B$}\)</span> and <span class="math inline">\(\mbox{$\mathbf Q$}\)</span> matrices in the
previous model to: <span class="math display">\[\begin{equation*}
\mbox{$\mathbf B$}= \begin{bmatrix}b-0.1&amp;0\\
0&amp;b+0.1\end{bmatrix}\quad
\mbox{$\mathbf Q$}= \begin{bmatrix}1&amp;0\\ 0&amp;1\end{bmatrix}\quad
\mbox{$\mathbf Z$}= \begin{bmatrix}z_1-z_2&amp;2 z_1\\ 0&amp;z_1\\
z_2&amp;0\end{bmatrix}
\end{equation*}\]</span> <em><span class="math inline">\(\mbox{$\mathbf
Q$}\)</span> is fixed because <span class="math inline">\(\mbox{$\mathbf
Z$}\)</span> is estimated and estimating both creates a statistically
confounded model (both scale the variance of <span class="math inline">\(\boldsymbol{x}\)</span>).</em></p>
<p>This would be specified as (notice <code>&quot;1*z1+-1*z2&quot;</code> for
<code>z1-z2</code>):</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>B1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">list</span>(<span class="st">&quot;-0.1+1*b&quot;</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="st">&quot;0.1+1*b&quot;</span>),<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>Q1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">list</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>),<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>Z1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">list</span>(<span class="st">&quot;1*z1+-1*z2&quot;</span>,<span class="dv">0</span>,<span class="st">&quot;z2&quot;</span>,<span class="st">&quot;2*z1&quot;</span>,<span class="st">&quot;z1&quot;</span>,<span class="dv">0</span>),<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>model.list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">B=</span>B1,<span class="at">U=</span>U1,<span class="at">Q=</span>Q1,<span class="at">Z=</span>Z1,<span class="at">A=</span>A1,<span class="at">R=</span>R1,<span class="at">x0=</span>pi1,<span class="at">V0=</span>V1,<span class="at">tinitx=</span><span class="dv">0</span>)</span></code></pre></div>
<p>Fit as usual:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(y, <span class="at">model=</span>model.list, <span class="at">silent =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="time-varying-parameters" class="section level2">
<h2>Time-varying parameters</h2>
<p>The default model form allows you to pass in a 3-D array for a
time-varying parameter (<span class="math inline">\(T\)</span> is the
number of time-steps in your data and is the 3rd dimension in the
array):<br />
<span class="math display">\[\begin{equation}\label{qeq:MARSS.tv}
\begin{gathered}
\boldsymbol{x}_t = \mbox{$\mathbf B$}_t\boldsymbol{x}_{t-1} +
\mbox{$\mathbf U$}_t + \mbox{$\mathbf C$}_t\mbox{$\mathbf c$}_t +
\mbox{$\mathbf G$}_t\boldsymbol{w}_t, \quad
\boldsymbol{W}_t \sim \,\textup{\textrm{MVN}}(0,\mbox{$\mathbf Q$}_t)\\
\boldsymbol{y}_t = \mbox{$\mathbf Z$}_t\boldsymbol{x}_t + \mbox{$\mathbf
A$}_t + \mbox{$\mathbf D$}_t\mbox{$\mathbf d$}_t + \mbox{$\mathbf
H$}_t\boldsymbol{v}_t, \quad
\boldsymbol{V}_t \sim \,\textup{\textrm{MVN}}(0,\mbox{$\mathbf R$}_t)\\
\boldsymbol{x}_{t_0} \sim
\,\textup{\textrm{MVN}}(\boldsymbol{\xi},\boldsymbol{\Lambda})
\end{gathered}
\end{equation}\]</span> Zeros are allowed on the diagonals of <span class="math inline">\(\mbox{$\mathbf Q$}\)</span>, <span class="math inline">\(\mbox{$\mathbf R$}\)</span> and <span class="math inline">\(\boldsymbol{\Lambda}\)</span>. NOTE(!!), the time
indexing. Make sure you enter your arrays such that the correct
parameter (or input) at time <span class="math inline">\(t\)</span>
lines up with <span class="math inline">\(\boldsymbol{x}_t\)</span>;
e.g., it is common for state equations to have <span class="math inline">\(\mbox{$\mathbf B$}_{t-1}\)</span> lined up with
<span class="math inline">\(\boldsymbol{x}_t\)</span> so you might need
to enter the <span class="math inline">\(\mbox{$\mathbf B$}\)</span>
array such that your <span class="math inline">\(\mbox{$\mathbf
B$}_{t-1}\)</span> is entered at <code>Bt[,,t]</code> in your code.</p>
<p>The length of the 3rd dimension must be the same as your data. For
example, say in your mean-reverting random walk model (the example on
the first page) you wanted <span class="math inline">\(\mbox{$\mathbf
B$}(2,2)\)</span> to be one value before <span class="math inline">\(t=20\)</span> and another value after but <span class="math inline">\(\mbox{$\mathbf B$}(1,1)\)</span> to be time
constant. You can pass in the following:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">dim</span>(y)[<span class="dv">2</span>]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>B1 <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">list</span>(),<span class="at">dim=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,TT))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>B1[,,<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>] <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">list</span>(<span class="st">&quot;b&quot;</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="st">&quot;b_1&quot;</span>),<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>B1[,,<span class="dv">21</span><span class="sc">:</span>TT] <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">list</span>(<span class="st">&quot;b&quot;</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="st">&quot;b_2&quot;</span>),<span class="dv">2</span>,<span class="dv">2</span>)</span></code></pre></div>
<p>Notice the specification is one-to-one to your <span class="math inline">\(\mbox{$\mathbf B$}_t\)</span> matrices on
paper.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
